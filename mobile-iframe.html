<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=3.0">
    <title>Ievolve Event Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, html {
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        #app-frame {
            width: 100%;
            height: 100vh;
            border: none;
            display: block;
        }
        
        /* Mobile optimizations */
        @media screen and (max-width: 768px) {
            body {
                overflow: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            #app-frame {
                height: 100vh;
                min-height: 600px;
                transform-origin: 0 0;
            }
        }
        
        /* Very small screens */
        @media screen and (max-width: 480px) {
            #app-frame {
                min-height: 700px;
                /* Scale up for better visibility on small screens */
                transform: scale(1.1);
                transform-origin: 0 0;
                width: 91%; /* Adjust width to compensate for scaling */
            }
            
            body {
                background-color: #f5f5f5;
            }
        }
        
        /* Loading indicator */
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #666;
            z-index: 1000;
        }
        
        /* Hide loading once iframe loads */
        #app-frame.loaded + #loading {
            display: none;
        }
        
        /* Fullscreen button for mobile */
        @media screen and (max-width: 768px) {
            #fullscreen-btn {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #007bff;
                color: white;
                border: none;
                border-radius: 50px;
                padding: 12px 20px;
                font-size: 14px;
                cursor: pointer;
                z-index: 1001;
                box-shadow: 0 4px 12px rgba(0,123,255,0.3);
                display: block;
            }
        }
        
        #fullscreen-btn {
            display: none;
        }
        
        /* Landscape mode adjustments */
        @media screen and (orientation: landscape) and (max-height: 500px) {
            #app-frame {
                height: 100vh;
                transform: none;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <iframe 
        id="app-frame" 
        src="https://d698c84b-fbd4-42e1-8652-8b92c3450c5f-00-jk2pa9a1bwct.riker.replit.dev"
        title="Ievolve Event Management System"
        allow="camera; microphone; geolocation"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
        loading="lazy"
        onerror="handleIframeError()">
    </iframe>
    
    <div id="loading">Loading Event Management System...</div>
    
    <button id="fullscreen-btn" onclick="toggleFullscreen()">â›¶ Fullscreen</button>
    
    <script>
        let serverCheckInterval;
        let errorShown = false;
        
        // Remove loading indicator when iframe loads
        document.getElementById('app-frame').onload = function() {
            this.classList.add('loaded');
            errorShown = false;
            clearInterval(serverCheckInterval);
        };
        
        // Handle iframe loading errors
        function handleIframeError() {
            if (!errorShown) {
                showErrorPage();
            }
        }
        
        // Check if server is responding
        function checkServerStatus() {
            fetch('https://d698c84b-fbd4-42e1-8652-8b92c3450c5f-00-jk2pa9a1bwct.riker.replit.dev/api/auth/me', {
                method: 'GET',
                mode: 'no-cors'
            })
            .then(() => {
                // Server is responding, reload iframe if it was showing error
                if (errorShown) {
                    location.reload();
                }
            })
            .catch(() => {
                // Server not responding
                if (!errorShown) {
                    showErrorPage();
                }
            });
        }
        
        // Show custom error page instead of Replit error
        function showErrorPage() {
            errorShown = true;
            document.body.innerHTML = `
                <div style="
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 20px;
                    margin: 0;
                ">
                    <div style="
                        background: white;
                        border-radius: 12px;
                        padding: 40px;
                        max-width: 500px;
                        width: 100%;
                        text-align: center;
                        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                    ">
                        <div style="
                            background: linear-gradient(135deg, #667eea, #764ba2);
                            color: white;
                            padding: 15px 30px;
                            border-radius: 8px;
                            font-size: 18px;
                            font-weight: bold;
                            margin-bottom: 30px;
                            display: inline-block;
                        ">IEVOLVE EVENT MANAGEMENT</div>
                        
                        <h1 style="color: #333; font-size: 28px; margin-bottom: 15px;">System Maintenance</h1>
                        <div style="color: #666; font-size: 18px; margin-bottom: 30px;">Chief Minister Trophy - Tamil Nadu</div>
                        
                        <div style="color: #555; font-size: 16px; line-height: 1.6; margin-bottom: 30px;">
                            Our event management system is temporarily unavailable. We're working to restore service.
                        </div>
                        
                        <button onclick="location.reload()" style="
                            background: linear-gradient(135deg, #667eea, #764ba2);
                            color: white;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            margin-right: 15px;
                        ">Try Again</button>
                        
                        <div style="margin-top: 20px; color: #888; font-size: 14px;">
                            Automatically retrying in <span id="countdown">30</span> seconds...
                        </div>
                    </div>
                </div>
            `;
            
            // Auto-retry countdown
            let countdown = 30;
            const countdownEl = document.getElementById('countdown');
            const interval = setInterval(() => {
                countdown--;
                if (countdownEl) countdownEl.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(interval);
                    location.reload();
                }
            }, 1000);
        }
        
        // Start monitoring server status
        serverCheckInterval = setInterval(checkServerStatus, 15000); // Check every 15 seconds
        
        // Initial check after 3 seconds
        setTimeout(checkServerStatus, 3000);
        
        // Fullscreen functionality for mobile
        function toggleFullscreen() {
            const iframe = document.getElementById('app-frame');
            if (!document.fullscreenElement) {
                iframe.requestFullscreen().catch(err => {
                    console.log('Fullscreen not supported');
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        // Adjust iframe height based on content (if same-origin)
        function adjustIframeHeight() {
            const iframe = document.getElementById('app-frame');
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const height = iframeDoc.body.scrollHeight;
                if (height > 0) {
                    iframe.style.height = height + 'px';
                }
            } catch (e) {
                // Cross-origin, can't access content
                console.log('Cannot adjust height for cross-origin iframe');
            }
        }
        
        // Handle orientation changes
        window.addEventListener('orientationchange', function() {
            setTimeout(adjustIframeHeight, 500);
        });
        
        // Prevent zoom on input focus (iOS)
        document.addEventListener('touchstart', function(event) {
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                event.target.style.fontSize = '16px';
            }
        });
        
        // Message handling from iframe (if needed)
        window.addEventListener('message', function(event) {
            // Handle messages from the embedded app
            if (event.data && event.data.type === 'resize') {
                const iframe = document.getElementById('app-frame');
                iframe.style.height = event.data.height + 'px';
            }
        });
    </script>
</body>
</html>